<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.sound.min.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="sketch.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="style.css">

    <script>
    var initWebRTC = function() {

      // These help with cross-browser functionality
      window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;

      // The video element on the page to display the webcam
      var video = document.getElementById('thevideo');

      // if we have the method
      if (navigator.getUserMedia) {
        navigator.getUserMedia({video: true}, function(stream) {
            video.src = window.URL.createObjectURL(stream) || stream;
            video.play();
          }, function(error) {alert("Failure " + error.code);});
      }

      var thecanvas = document.getElementById('thecanvas');
      var thecontext = thecanvas.getContext('2d');

      var draw = function() {
        thecontext.drawImage(video,0,0,video.width,video.height);
        var dataUrl = thecanvas.toDataURL('image/webp', 1);
        document.getElementById('imagefile').src = dataUrl;
        socket.emit('image', dataUrl);
        // setTimeout(draw,3000);

      };

      draw();
    };

    window.addEventListener('load', initWebRTC);
    </script>
    <title></title>
  </head>
  <body>
    <img id='neon' src='slow.gif'>
    <script>

    var socket = io.connect('//localhost:3000');
        //listen for data on websocket called my socket
        socket.on('mysocket', function(data) {
            console.log(data);
            //Jquery has getters and setters
            $('#incoming').text(data);
            var today = new Date();
            $('#facepic').attr("src","images/test_image.jpg?" + today.getTime());
        });
        socket.on('error', function() {
            console.error(arguments)
        });
    </script>

    <script>
    function move() {
      var elem = document.getElementById("myBar");
      var width = 1;
      var id = setInterval(frame, 10);
      function frame() {
          if (width >= 100) {
              clearInterval(id);
          } else {
              width++;
              elem.style.width = width + '%';
          }
      }
    }
    </script>

    <button id='scanbutton' onclick="move()">Click Me</button>
    <button id='seebutton' onclick="initWebRTC()">and click Me</button>

    <div id="myProgress">
      <div id="myBar"></div>
    </div>
    <img src="" id="imagefile">
    <img id="facepic"/>
    <video id="thevideo" width='320' height='320' autoplay></video>
    <h1 id="incoming"></h1>
    <canvas id="thecanvas" width="320" height="240"></canvas>




  </body>
</html>
